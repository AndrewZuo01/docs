---
title: '业务服务器源码部署'
sidebar_position: 2
---

# 源码部署-单机

> > 简要说明：业务服务器部署

```
1、Zookeeper //服务注册与发现
2、MySQL(version:5.7)//用户业务信息以及管理后台查询消息使用
```

## 1、服务器环境说明

Linux 系统 （目前仅支持 linux 下的部署，其他系统的部署需要自行修改脚本）

获取 OpenIM 源码需要 git 环境，服务器如果没有需要安装 git

开发语言为 go 语言(需要`go 1.18`或以上版本)
，源码部署需要[搭建 go 语言环境](https://doc.rentsoft.cn/#/qa/docker?id=_1golang%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85)

## 2、拉取项目源码

```
git clone https://github.com/OpenIMSDK/chat.git
```

## 3、修改配置文件参数

```
cd chat/config
vim config.yaml
```

- 修改 Zookeeper 配置项

```
zookeeper:
  schema: openim                          #不建议修改
  address: [ 127.0.0.1:2181 ]             #组件部署在本地默认IP+监听端口(部署的Zookeeper端口默认为2181，如果未修改，记得修改此项配置)即可，部署在其他服务器，更换为服务监听的IP+端口
  username:                               #用户名
  password:                               #密码
```

- 修改 MySQL 配置项(未配置的默认和 OpenIMServer 保持一致)

```
mysql:
  address: [ 127.0.0.1:13306 ]            #组件部署在本地默认IP+监听端口(部署的MySQL端口默认为3306，如果未修改，记得修改此项配置)即可，部署在其他服务器，更换为服务监听的IP+端口
  username: root                          #用户名
  password: openIM123                     #密码
  database: openim_enterprise             #不建议修改
  maxOpenConn: 1000                       #最大连接数
  maxIdleConn: 100                        #最大空闲连接数
  maxLifeTime: 60                         #连接可以重复使用的最长时间（秒）
  logLevel: 4                             #日志级别 1=slient 2=error 3=warn 4=info
  slowThreshold: 500                      #慢语句阈值 （毫秒）
```

## 4、编译构建

```
cd chat/script
chmod +x *.sh
./build_all_service.sh
```

## 5、启动服务并检查

```
./start_all.sh; ./check_all.sh
```

## 6、IM 开放端口

| 端口      | 说明                  | 操作                                  |
| --------- | --------------------- | ------------------------------------- |
| TCP:10008 | App 调用 API 端口     | 端口放行或 nginx 反向代理，关闭防火墙 |
| TCP:10009 | 管理后台调用 API 端口 | 端口放行或 nginx 反向代理，关闭防火墙 |

注：如果使用 nginx 做反向代理，则只需要开放 443 端口即可。至此 openIM 的服务器已经搭建完毕，可通过[下载体验 app 修改 IP](https://doc.rentsoft.cn/#/v2/validation/app)
的方式访问验证。

# 源码部署-单机-更新代码

```
源码更新说明: openIM发布新的版本后，会更新项目文件到main分支下，除开源代码外，还有配置文件config/config.yaml会更新，用户如果修改过这个文件，在使用git pull可能会有冲突，需要自行备份，然后比对，解决冲突，重新放置到config/文件夹。
```

## 1.关闭服务

```
cd chat/script ; ./stop_all.sh
```

## 2.备份修改过的文件

```
config/config.yaml文件,可将其重命名为config_bak.yaml
```

## 3.拉取最新配置文件和源代码

```
git pull(注:可通过git branch -a 确保自己在main分支下)
```

## 4.修改配置文件冲突

```
config/config.yaml文件冲突，将备份文件config_bak.yaml和新版本config.yaml比对合并
```

## 5.重新构建编译

```
./build_all_service.sh
```

## 6.重新启动服务

```
./start_all.sh
```

## 7.检查

```
./check_all.sh
```
