---
title: 'docker-compose部署'
sidebar_position: 4
---


# docker部署

## 环境及系统要求

| 注意事项 | 详细说明                                                     |
| -------- | ------------------------------------------------------------ |
| 操作系统 | linux系统即可， Ubuntu 7.5.0-3ubuntu1~18.04最优，root用户    |
| 硬件资源 | 可用内存2G以上，用户量小于10万，可用单机部署，8C 16G 10Mb 1T普通磁盘即可 |
| golang   | 1.18及以上                                                   |
| docker   | 23.0.1及以上                                                 |
| git      | 2.17.1及以上                                                 |

## 存储组件

| 存储组件  | 建议版本    |
| --------- | ----------- |
| mongodb   | 6.0.2及以上 |
| redis     | 7.0.0及以上 |
| zookeeper | latest      |
| kafka     | latest      |
| mysql     | 5.7及以上   |
| minio     | latest      |

1.拉镜像启动

```bash
git clone https://github.com/openim-sigs/openim-docker openim/openim-docker && export openim=$(pwd)/openim && cd $openim/openim-docker && export PASSWORD="YourPassword" && make init && docker compose up -d
```

2.常用环境变量

```bash
# 选择 chat 版本 和 server 版本https://github.com/OpenIMSDK/Open-IM-Server/blob/main/docs/conversions/images.md, eg: main, release-v*.* 仅支持3.3/1.3之后的版本
#export CHAT_BRANCH="main"   # 设置 chat 版本，默认是 main 
#export SERVER_BRANCH="main" # 设置 server 版本，默认是 main
# export PASSWORD="openIM123" # 所有组件的密码，至少8位，不能包含特色字符，默认是openIM123 
# export USER="root" # 设置用户名，目前只支持root
# API_URL: 内网环境下，需设置 OpenIM Server API 提供服务的地址；外网环境下会自动获取
# export API_URL="http://127.0.0.1:10002"
# export DATA_DIR="./" #设置组件挂载的数据卷目录，默认为./
```

3.查看日志

```bash
docker compose logs openim-server
docker compose logs openim-chat
```

![docker-chat](./assets/docker-chat.png)

![docker-im](./assets/docker-im.png)



4.查看健康状态-healthy

```bash
docker ps
```

![docker-ps](./assets/docker-ps.png)


## 开放端口

开放 IM 端口

| TCP 端口  | 说明                                                  | 操作                                    |
| --------- | ----------------------------------------------------- | --------------------------------------- |
| TCP:10001 | ws 协议，消息端口，如消息发送、推送等，用于客户端 SDK | 端口放行或 nginx 反向代理，并关闭防火墙 |
| TCP:10002 | api 端口，如用户、好友、群组、消息等接口。            | 端口放行或 nginx 反向代理，并关闭防火墙 |
| TCP:10005 | 选择 minio 存储时需要(openIM 默认使用 minio 存储)     | 端口放行或 nginx 反向代理，并关闭防火墙 |

开放 Chat 端口

| TCP 端口  | 说明                     | 操作                                    |
| --------- | ------------------------ | --------------------------------------- |
| TCP:10008 | 业务系统，如注册、登录等 | 端口放行或 nginx 反向代理，并关闭防火墙 |
| TCP:10009 | 管理后台，如统计、封号等 | 端口放行或 nginx 反向代理，并关闭防火墙 |
