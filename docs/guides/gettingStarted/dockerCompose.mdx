---
title: 'docker部署'
sidebar_position: 2
---


# docker部署

## 环境及系统要求

| 注意事项 | 详细说明                                                     |
| -------- | ------------------------------------------------------------ |
| 操作系统 | linux系统即可， Ubuntu 22.04最优，root用户    |
| 硬件资源 | 可用内存2G以上，用户量小于10万，可用单机部署，8C 16G 10Mb 1T普通磁盘即可 |
| golang   | 1.18及以上                                                   |
| docker   | Docker version 24.0.5, build ced0996及以上                                                 |
| git      | 2.17.1及以上                                                 |

## 存储组件

| 存储组件  | 建议版本    |
| --------- | ----------- |
| mongodb   | 6.0.2及以上 |
| redis     | 7.0.0及以上 |
| zookeeper | latest      |
| kafka     | latest      |
| mysql     | 5.7及以上   |
| minio     | latest      |





## 一、设置常用环境变量

**CHAT_BRANCH**
  - **描述**：设置 chat 版本
  - **默认值**：`release-v1.3`
  - **注意事项**：
    - 支持1.3及之后的版本
	```bash
   export CHAT_BRANCH="release-v1.3"
    ```

**SERVER_BRANCH**
  - **描述**：设置 OpenIMServer 版本
  - **默认值**：`release-v3.3`
  - **注意事项**：
    - 支持3.3及之后的版本
	```bash
   export CHAT_BRANCH="release-v3.3"
    ```	
	
	

**PASSWORD**
  - **描述**：用于 mysql/mongodb/redis/minio 组件的密码
  - **默认值**：`openIM123`
  - **注意事项**：
    - 密码长度应至少为8个字符。
    - 不能包含任何特殊字符。
	```bash
    export PASSWORD="openIM123"
    ```
	
**USER**
  - **描述**：用于 mysql/mongodb/redis/minio 组件的用户名
  - **默认值**：`root`
  
    ```bash
    export USER="root"
    ```
	
**API_URL**
  - **描述**：API的地址
  - **说明**：如服务器有外网ip，则会自动获取，不需要设置此环境变量；如果本机是内网环境，需要设置此环境变量为对内服务的ip。
  
    ```bash
    export API_URL="http://ip:10002"
    ```

**DATA_DIR**
  - **描述**：组件挂载的数据卷目录
  - **默认值**：`./`
  
    ```bash
    export DATA_DIR="./"
    ```

---

### 更多环境变量

要了解更多关于环境变量的详细信息，请参考 [此文档](https://github.com/openimsdk/open-im-server/blob/main/docs/contrib/environment.md)。

> **注意**：使用 `export` 设置的环境变量优先级高于脚本中的变量。

---




## 二、拉镜像启动

```bash
git clone https://github.com/openim-sigs/openim-docker openim/openim-docker && export openim=$(pwd)/openim && cd $openim/openim-docker  && make init && docker compose up -d
```
如何您的docker版本不支持compose，可以按照这个升级插件https://docs.docker.com/compose/install/linux/#install-using-the-repository 后再 docker compose up -d


3.查看日志

```bash
docker compose logs openim-server
docker compose logs openim-chat
```

![docker-chat](./assets/docker-chat.png)

![docker-im](./assets/docker-im.png)

更多日志查看openim-server/分支/logs/ 和 openim-chat/分支/logs 


4.查看健康状态-healthy

```bash
docker ps
```

![docker-ps](./assets/docker-ps.png)


5.pc web体验
浏览器访问http://ip:11001



### 其它问题

1. 如想使用某些外部组件，该如何修改

```bash
举例说明，如想使用外部的mysql，操作步骤如下：
1.编辑docker-compose.yaml 在此文件中注释掉mysql相关配置项
2.编辑scripts/install/environment.sh 修改mysql的ip port及密码等配置项
3.make init使配置生效
4.docker compose up -d启动
```

2. 健康状态starting

```bash
在第一次健康检查完成之前，Docker 默认会将容器的健康状态设置为 starting。目前是1分钟检测一次，正常情况下1分钟后会变成healthy状态
```

3. 端口映射

```bash
Docker networks自定义，端口可以正常映射

```

4. docker版本

```bash
 新版docker已经整合docker dompose作为其核心功能的一部分，不需单独安装docker-compose，且某些老版本docker不支持gateway。
 如果您的docker版本过低，建议升级到新版本，官方使用的是23.0.1版本。docker升级可以查看这个链接https://segmentfault.com/a/1190000042702027
```





## 三、快速验证
请参考 [快速验证](./quickTestServer)文档
