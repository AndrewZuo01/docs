---
title: 'Open-IM-Server源码部署'
sidebar_position: 1
---

# 源码部署

## 环境及系统要求

| 注意事项 | 详细说明                                                     |
| -------- | ------------------------------------------------------------ |
| 操作系统 | linux系统即可， Ubuntu 7.5.0-3ubuntu1~18.04最优，root用户    |
| 硬件资源 | 可用内存2G以上，用户量小于10万，可用单机部署，8C 16G 10Mb 1T普通磁盘即可 |
| golang   | 1.18及以上                                                   |
| docker   | 23.0.1及以上                                                 |
| git      | 2.17.1及以上                                                 |

## 存储组件

| 存储组件  | 建议版本    |
| --------- | ----------- |
| mongodb   | 6.0.2及以上 |
| redis     | 7.0.0及以上 |
| zookeeper | latest      |
| kafka     | latest      |
| mysql     | 5.7及以上   |
| minio     | latest      |

## 一、先部署组件

1. clone仓库

```bash
git clone https://github.com/OpenIMSDK/Open-IM-Server.git && cd Open-IM-Server
```

2. 部署组件

```bash
curl https://raw.githubusercontent.com/OpenIMSDK/openim-docker/main/example/basic-openim-server-dependency.yml -o basic-openim-server-dependency.yml && export PASSWORD="YourPassword"  USER="root" && make init && docker compose -f basic-openim-server-dependency.yml up -d
```

3. 常用环境变量

```bash
# export PASSWORD="openIM123" # 所有组件的密码，至少8位，不能包含特色字符，默认是openIM123 
# export USER="root" # 设置用户名，目前只支持root
# API_URL: 内网环境下，需设置 OpenIM Server API 提供服务的地址；外网环境下会自动获取
# export API_URL="http://127.0.0.1:10002"
# export DATA_DIR="./" #设置组件挂载的数据卷目录，默认为./
```

## 二、编译/启动/检测/停止 Open-IM-Server

1. 编译

```bash
./scripts/build-all-service.sh
```

  2.启动

```bash
./scripts/start-all.sh
```

3. 检测

```bash
./scripts/check-all.sh
```

![im](./assets/im.png)



4. 停止

```bash
./scripts/stop-all.sh
```

### 其它问题

如想使用某些外部组件，该如何修改

```bash
举例说明，如想使用外部的mysql，操作步骤如下：
1.编辑basic-openim-server-dependency.ymll 在此文件中注释掉mysql相关配置项
2.编辑scripts/install/environment.sh 修改mysql的ip port及密码等配置项
3.make init使配置生效
4.docker compose -f basic-openim-server-dependency.yml up -d启动组件
```

## 三、编译/启动/检测/停止chat

1. 克隆

```bash
#先回到上一级目录
cd .. 
git clone https://github.com/OpenIMSDK/chat.git && cd chat
```

2.编译

```bash
./scripts/build_all_service.sh
```

3.启动

```bash
./scripts/start_all.sh
```

4.检测

```bash
./scripts/check_all.sh --print-screen
```

![chat](./assets/chat.png)

5.停止

```bash
./scripts/stop_all.sh
```

## 8、IM 开放端口

| TCP 端口  | 说明                                                  | 操作                                    |
| --------- | ----------------------------------------------------- | --------------------------------------- |
| TCP:10001 | ws 协议，消息端口，如消息发送、推送等，用于客户端 SDK | 端口放行或 nginx 反向代理，并关闭防火墙 |
| TCP:10002 | api 端口，如用户、好友、群组、消息等接口。            | 端口放行或 nginx 反向代理，并关闭防火墙 |
| TCP:10005 | 选择 minio 存储时需要(openIM 默认使用 minio 存储)     | 端口放行或 nginx 反向代理，并关闭防火墙 |
